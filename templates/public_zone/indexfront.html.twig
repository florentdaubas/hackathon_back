<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->


<!--[if gt IE 8]><!-->
<html lang="fr">
<!--<![endif]-->


<<<<<<< HEAD


<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="stylesheet" href="css/leaflet.css">
    <link rel="stylesheet" href="css/MarkerCluster.css">
    <link rel="stylesheet" href="css/Leaflet.Photo.css">
    <link rel="stylesheet" href="css/map.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" href="css/accueil.css">
    <link rel="stylesheet" href="css/meteo.css">
    <link rel="stylesheet" href="css/navbottom.css">
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/themes/smoothness/jquery-ui.css" />


    <!-- FONT AWESOME CDN -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700" rel="stylesheet">

    <script src="javascript/vendor/modernizr-2.8.3-respond-1.4.2.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="javascript/leaflet.js"></script>
    <script src="javascript/leaflet.markercluster.js"></script>
    <script src="javascript/Leaflet.Photo.js"></script>
    <script src="javascript/anime.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/jquery-ui.min.js"></script>
    <script src="javascript/navbottom.js"></script>


    <title>Code4Marseille - Provence Tourisme</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="Provence Tourisme">
    <meta name="copyright" content="Provence Tourisme">
    <meta name="keywords" content="Provence Tourisme">

</head>
<body>
<div class='header'>
    <div class="accueil">
        <div class="container">
            <div class="row">
                <header class="col-xs-12 ml-1">
                    <a href="#"></a><img src="media/c4m.png" alt="" class="logo" /></a>
                    <nav class="">
                        <!-- Navigation Top -->
                        <ul class="hidden">
                            <li class=""></li>
                            <li class=""></li>
                        </ul>
                    </nav>
                </header>
            </div>
        </div>

        <article>
            <!-- Full width -->
            <div class="container">
                <div class="row">
                    <section id="intro" class="text-center col-xs-12 ml-1 mr-1">
                        <!-- Background animé avec jquery et hashtag -->
                        <h1 id="titre" class="animated bounce"> Découvrez en direct les merveilles du département.</h1>
                        <div id="alternate">
                            <h2 id="lieux" class="text-center col-xs-12 ml-1 mr-1 boutonanime from-middle"></h2>
                        </div>
                        <!-- ANCIENNE PHRASE D'ACCROCHE CELLE QUI APPARAIT EST SOUMISE A L'APPROBATION DE MY PROVENCE EVIDEMMENT -->
                        <!-- Ancienne <p class="">Des villes contemporaines qui abritent des petits villages de pêcheurs et des quartiers
                        alternatifs.</p> -->
                        <h3 class="text-center col-xs-12 ml-1 mr-1"> Bienvenue en Provence </h3>
                    </section>
=======
{# filtres par catégories #}
            <div class="row my-2">
                <div class="col-xs-12 col-sm-12 d-flex justify-content-between flex-wrap">
                    {% for categorie in listeCategorie %}
                        <a href="{{ path('actus', {'urlCategorie': categorie.urlName}) }}" 
                            class="btn btn-danger" data-container="body" data-toggle="popover" data-placement="top" data-trigger="hover focus" 
                            data-content="{{ categorie.description }}">
                            {{ categorie.name }}
                        </a>
                    {% endfor %}
>>>>>>> origin/master
                </div>
            </div>

            <div class="container">
                <div class="row">





                    <section id="bandeau" class="text-center col-xs-12 ml-1 mr-1">



                        <!--SUPPRESSION DU BANDEAU POUR NE PAS AVOIR 2 CARTES
                         Bas de page avec boutons visible sur page home avec fond transparent
                         <span class="dropdown">
                             <button class="btn-medium bouton" data-toggle="dropdown">Ville
                                 <div class="dropdown-menu">
                                     <div class="dropdown-item">Marseille</div>
                                     <div class="dropdown-item">Plan de Cuques</div>
                                     <div class="dropdown-item">Allauch</div>
                                     <div class="dropdown-item">Aix en Provence</div>
                                 </div>
                             </button>
                         </span>
                         <span class="dropdown">
                             <button class="btn-medium bouton" data-toggle="dropdown">Activité
                                 <div class="dropdown-menu">
                                     <div class="dropdown-item">Faire du sport</div>
                                     <div class="dropdown-item">Bon plan en famille</div>
                                     <div class="dropdown-item">Aller au restaurant</div>
                                     <div class="dropdown-item">Un peu de culture</div>
                                 </div>
                             </button>
                           </span> -->

                        <a href="bons_plans.php" title=""><button class="btn-medium bouton">Bons plans</button></a>
                        <a href="autour.php" title=""><button class="btn-medium bouton">Autour de moi</button></a>
                    </section>

                </div>
            </div>
    </div>
</div>

<div class="WallOfPictures">
    <div class="liste">
        <!-- ICI ON VA CREER UNE BALISE div PAR INFO RECUPERE -->
    </div>

</div>        <div class="map">
    <div id="mapHome"></div>
    <div id="navBottom" class="container-fluid">
        <div class="row">
            <div class="col-md-4 mt-2">
                <form>
                    <div class="form-row align-items-center w-80">
                        <label class="sr-only" for="inlineFormInputGroup">hashtag</label>
                        <div class="input-group mb-2">
                            <div class="input-group-prepend">
                                <div class="input-group-text borderRoundL p-1">#</div>
                            </div>
                            <input type="text" class="form-control" id="inputHashtag" placeholder="hashtag">
                            <div class="input-group-prepend">
                                <div class="input-group-text borderRoundR">
                                    <button id="hashtag" class="btn" type="button" name="buttonHashtag">OK</button>
                                </div>

                            </div>
                        </div>
                    </div>
                </form>

            </div>
            <div class="col-md-2 mt-2 btnUtil">
                <div class="marker-menu" >
                    <img class="draggable-marker" src="./img/map/question.png" alt="marker" />
                </div>
                <button type="button" class="btn btn-primary mr-2 myPosition" style="border-radius:100px">
                    <i class="fa fa-crosshairs"></i>
                </button>
            </div>
            <div class="col-md-6 mt-2">
                <div class="row float-right">

                    <button type="button" id="showRight" class="btn btn-info mr-2" style="border-radius:100px">
                        <i class="fa fa-compass"></i>
                    </button>
                    <button type="button" class="btn btn-secondary mr-2" style="border-radius:100px">
                        <i class="fa fa-camera-retro"></i>
                    </button>
                    <button type="button" id="showOverlay" class="btn btn-success mr-2" style="border-radius:100px">
                        <i class="fa fa-heart"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div id="navBotMob" class="container-fluid ">
        <div class="row text-center categoryHide">
            <div class="col-6">
                <div class="mt-2">
                    <i></i> <a><p>Musique</p></a>
                </div>
                <div class="mt-2">
                    <i></i> <a><p>Divertissement</p></a>
                </div>
                <div class="mt-2">
                    <i></i> <a><p>Shopping</p></a>
                </div>
                <div class="mt-2">
                    <i></i> <a><p>Restauration</p></a>
                </div>
            </div>
            <div class="col-6">
                <div class="mt-2">
                    <i></i> <a><p>Promenade</p></a>
                </div>
                <div class="mt-2">
                    <i></i> <a><p>Logement</p></a>
                </div>
                <div class="mt-2">
                    <i></i> <a><p>Sport</p></a>
                </div>
                <div class="mt-2">
                    <i></i> <a><p>Culture</p></a>
                </div>
            </div>

        </div>



        <div class="row">
            <div class="col-4 mt-2">
                <form>
                    <div class="form-row align-items-center w-80">
                        <label class="sr-only" for="inlineFormInputGroup">hashtag</label>
                        <div class="input-group mb-2">
                            <div class="input-group-prepend">
                                <div class="input-group-text borderRoundL p-1">#</div>
                            </div>
                            <input type="text" class="form-control" id="inputHashtag" placeholder="hashtag">
                            <div class="input-group-prepend">
                                <div class="input-group-text borderRoundR"><button id="hashtag">OK</button></div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <div class="col-4 mt-2 d-inline-block align-center btnMid p-0">
                <button type="button" class="btn btn-danger border-circle question" data-container="body" data-toggle="popover" data-placement="top">
                    <i class="fa fa-question"></i>
                </button>
                <button type="button" class="btn btn-primary border-circle " >
                    <i class="fa fa-crosshairs"></i>
                </button>
            </div>

            <div class="col-4 mt-2">
                <button type="button" name="filtre" class="btn filtreBy float-right">Filtrer par</button>
                <div class="" style="display:none;">
                    <button type="button" id="showRight" class="btn btn-info mr-2" style="border-radius:100px">
                        <i class="fa fa-compass"></i>
                    </button>
                    <button type="button" class="btn btn-secondary mr-2" style="border-radius:100px">
                        <i class="fa fa-camera-retro"></i>
                    </button>
                    <button type="button" id="showOverlay" class="btn btn-success mr-2" style="border-radius:100px">
                        <i class="fa fa-heart"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        jQuery(document).ready(function () {


            //alert('ok');

            $('.question').on('mouseover', () => {
                $('.question').popover({
                    container: 'body',
                    content: "Un doute ? Besoin d'info supplementaire ? Demandez à la comunuté !"
                });
                $('.question').popover('show');
                //alert('ok');
            })
            $('.question').on('mouseleave', () => {

                $('.question').popover('hide');
                //alert('ok');
            })

        });
    </script>
</div>


<div id="navRight" class="bounceIn animated" style="color:white;">
    <div class="card">
        <img class="card-img-top" src="./img.svg" alt="Card image cap">
        <!--<div class="card-body">
          <h5 class="card-title text-center">
            <a href=".." class="">
              Lorem ipsum dolor sit amet.
            </a>
          </h5>
          <p class="card-text"></p>
        </div>-->
        <div class="card-footer">
            <small class="text-muted"><i class="far fa-heart"></i> 2,500 like</small>
        </div>
    </div>
    <div class="card">
        <img class="card-img-top" src="./img.svg" alt="Card image cap">
        <!--<div class="card-body">
          <h5 class="card-title text-center">
            <a href=".." class="">
              Lorem ipsum dolor sit amet.
            </a>
          </h5>
          <p class="card-text"></p>
        </div>-->
        <div class="card-footer">
            <small class="text-muted"><i class="far fa-heart"></i> 2,500 like</small>
        </div>
    </div>
    <div class="card">
        <img class="card-img-top" src="./img.svg" alt="Card image cap">
        <!--<div class="card-body">
          <h5 class="card-title text-center">
            <a href=".." class="">
              Lorem ipsum dolor sit amet.
            </a>
          </h5>
          <p class="card-text"></p>
        </div>-->
        <div class="card-footer">
            <small class="text-muted"><i class="far fa-heart"></i> 2,500 like</small>
        </div>
    </div>


</div>
<div class="overlay-box bounceIn animated">
    <center>
        <h3>Jusqu'à quelle heure dure cet évenement ?</h3>

        <textarea></textarea>
    </center>
</div>
<!--BOUTON HAUT DE PAGE -->
<div id="UpPage"><img src="img/hautdepage.png" width="40" height="40"></div>
</body>
<script>

    var map = L.map('mapHome').setView([43.3, 5.4], 13);

    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
        maxZoom: 18,
        id: 'mapbox.streets'
    }).addTo(map);

    // GESTION POINTS BONS PLANS ECT..

    iconLayer = L.photo.cluster({spiderfyDistanceMultiplier: 1.6}).on('click', function (evt) {
        evt.layer.bindPopup(L.Util.template('<p><a href="{lien}" target="_blank">{caption}</a></p>', evt.layer.photo), {
            className: 'leaflet-popup-info',
            minWidth: 400
        });
    });

    questionLayer = L.photo.cluster({spiderfyDistanceMultiplier: 1.6}).on('click', function (evt) {
        evt.layer.bindPopup(L.Util.template('<p><a href="{lien}" target="_blank">{caption}</a></p>', evt.layer.photo), {
            className: 'leaflet-popup-info',
            minWidth: 400
        });
    });

    var idsInfos = [];

    function ajaxInfos() {

        /*if (photoLayer != null) {
         map.removeLayer(photoLayer);
         }*/

        var UrlApi = "https://myprovence.code4marseille.fr/api/infos";

        fetch(UrlApi)
            .then(function (reponse) {
                return reponse.json();
            })
            .then(function (objetJson) {
                //Nombres de pages à charger
                var LastPage = objetJson['hydra:totalItems'] / 100;
                var NbPages = Math.ceil(LastPage);
                for (var page = 1; page < NbPages + 1; page++) {
                    var url = UrlApi + '?page=' + page;
                    fetch(url)
                        .then(function (response) {
                            // SI ON VEUT GERER DU JSON
                            // ON VA TRANSFORMER LE RESULTAT EN OBJET JSON
                            return response.json();
                        })
                        .then(function (objetJson) {
                            var tableauInfo = objetJson["hydra:member"];
                            // BOUCLE POUR PARCOURIR LES INFOS UNE PAR UNE
                            for (var index = 0; index < tableauInfo.length; index++) {
                                var infoCourante = tableauInfo[index];
                                if (infoCourante.latitude && infoCourante.longitude) {
                                    var id = infoCourante["@id"];
                                    //Verification d'ajout d'image (live)
                                    if (idsInfos.includes(id) == false) {
                                        idsInfos.push(id);

                                        var lien = id;

                                        if (infoCourante.icon != null && infoCourante.description != null) {
                                            var photo = [{
                                                lat: infoCourante.latitude,
                                                lng: infoCourante.longitude,
                                                url: "img/map/" + infoCourante.icon + ".png",
                                                caption: infoCourante.description,
                                                thumbnail: "img/map/" + infoCourante.icon + ".png",
                                                icon: infoCourante.icon,
                                                lien: lien.replace('/api/infos/', 'https://myprovence.code4marseille.fr/info-public/')
                                            }];
                                            if (infoCourante.icon == "question") {
                                                questionLayer.add(photo).addTo(map);
                                            } else {
                                                iconLayer.add(photo).addTo(map);
                                            }
                                        }
                                    }
                                }
                            }
                        });
                }
            });
    }

    // GESTION POINTS INSTAGRAM

    photoLayer = L.photo.cluster({spiderfyDistanceMultiplier: 1.6}).on('click', function (evt) {
        evt.layer.bindPopup(L.Util.template('<img src="{url}"/><img src="img/logoInsta.png" style="display: inline-block; height: 40px !important; width: 40px !important;"><span><b>Photo de {username}</b></span><span style="float:right;"><img id="imgLike" src="img/instaLike.png"/></span><b style="float: right; line-height:28px;">{likes}</b><p>{caption}</p><br><br>', evt.layer.photo), {
            className: 'leaflet-popup-photo',
            minWidth: 400
        });
    });


    var photoLayer;
    var idInsta = [];

    function ajaxMap(hashtag = "code4marseille") {

        /*if (photoLayer != null) {
         map.removeLayer(photoLayer);
         }*/

        var UrlApi = "https://myprovence.code4marseille.fr/api/instas?tags=" + hashtag;

        fetch(UrlApi)
            .then(function (reponse) {
                return reponse.json();
            })
            .then(function (objetJson) {
                //Nombres de pages à charger
                var LastPage = objetJson['hydra:totalItems'] / 100;
                var NbPages = Math.ceil(LastPage);

                for (var page = 1; page < NbPages + 1; page++) {

                    var url = UrlApi + '&page=' + page;
                    fetch(url)
                        .then(function (response) {
                            // SI ON VEUT GERER DU JSON
                            // ON VA TRANSFORMER LE RESULTAT EN OBJET JSON
                            return response.json();
                        })
                        .then(function (objetJson) {
                            var tableauInfo = objetJson["hydra:member"];
                            var photos = [];
                            // BOUCLE POUR PARCOURIR LES INFOS UNE PAR UNE
                            for (var index = 0; index < tableauInfo.length; index++) {


                                var infoCourante = tableauInfo[index];

                                if (infoCourante.latitude && infoCourante.longitude) {
                                    var title = infoCourante.title;
                                    var likes = infoCourante.likes;
                                    var link = infoCourante.link;
                                    var latitude = infoCourante.latitude;
                                    var longitude = infoCourante.longitude;
                                    var description = infoCourante.caption;
                                    var publicationDate = infoCourante.publicationDate;
                                    var image = infoCourante.lowResolution;
                                    var id = infoCourante.id;
                                    var username = infoCourante.userUsername;

                                    //Verification d'ajout d'image (live)
                                    if (idInsta.includes(id) == false) {
                                        idInsta.push(id);
                                        //Verification si image existe encore
                                        var img = new Image();
                                        img.myLat = String(latitude);
                                        img.myLng = String(longitude);
                                        img.myLink = link;
                                        img.myDescription = description;
                                        img.myLikes = likes;
                                        img.myUsername = username;
                                        img.onload = function () {
                                            var photo = [{
                                                lat: this.myLat,
                                                lng: this.myLng,
                                                url: this.src,
                                                caption: "<a href='" + this.myLink + "'>" + this.myDescription + "</a>",
                                                thumbnail: this.src,
                                                likes: this.myLikes,
                                                username: this.myUsername
                                            }];
                                            photoLayer.add(photo).addTo(map);
                                        }
                                        img.src = infoCourante.lowResolution;
                                    }
                                }
                            }
                        });
                }
            });
    }

    var hashtag = "code4marseille";

    ajaxMap();

    setInterval(function () {
        ajaxMap(hashtag);
        ajaxInfos();
    }, 5000);


    $("#hashtag").click(function () {
        if ($("#inputHashtag").val().length > 2) {
            hashtag = $("#inputHashtag").val();
            ajaxMap(hashtag);
        } else {
            hashtag = "code4marseille";
            ajaxMap(hashtag);
        }
    });

    var page = 1;

    /*window.addEventListener('wheel', function (e) {
     if (e.deltaY < 10) {
     //scroll up
     }
     if (e.deltaY > 10) {
     //scroll down
     if (page == 1) {
     anime({
     targets: '.header',
     translateY: (document.body.clientWidth)
     });
     appelAjax(urlApiAjax, ajouterImage);
     $("#UpPage").show();
     page = 2;
     } else if (page == 2) {
     anime({
     targets: '.WallOfPictures',
     translateY: -(document.body.clientWidth)
     });
     anime({
     targets: '#navBottom',
     translateY: -50
     });
     page = 3;
     //$("#navBottom").slideDown(1000);
     }
     //$("#UpPage").show();
     }
     });*/

    $("#showOverlay").click(function () {
        if ($(".overlay-box").is(":visible")) {
            $(".overlay-box").hide();
        } else {
            $(".overlay-box").show();
        }
    });

    $("#showRight").click(function () {
        if ($("#navRight").is(":visible")) {
            $("#navRight").hide();
        } else {
            $("#navRight").show();
        }
    });

    var hauteur = (document.body.clientWidth);

    /*$("#UpPage").click(function () {
     if (page = 3) {
     anime({
     targets: '.WallOfPictures',
     translateY: 2500
     });
     anime({
     targets: '#navBottom',
     translateY: 50
     });
     page = 2;
     }
     });*/


    //SCRIPT DANIEL ACCUEIL.PHP
    $(document).ready(function () {
        $.fn.delay = function (time, callback) {
            jQuery.fx.step.delay = function () {};
            return this.animate({
                delay: 1
            }, time, callback);
        }

        $.getJSON('html/inc/accueil.json', function (data) {
            $.each(data, function (index, d) {
                $('#lieux').delay(5000, function () {

                    $('#lieux').html(d.hashtag);
                    $('article').css('background-image', 'url(' + d
                        .image + ')');

                    var alternate = anime({
                        targets: '#alternate .el',
                        translateX: -950,
                        direction: 'alternate'
                    });

                });
            });
        });

    });

    var urlApiAjax = 'https://myprovence.code4marseille.fr/api/instas?itemsPerPage=24';

    var appelAjax = function (urlApiAjax, callbackJson)
    {
        // https://developer.mozilla.org/fr/docs/Web/API/Fetch_API/Using_Fetch
        fetch(urlApiAjax)
            .then(function (data) {
                // ON VEUT RECEVOIR UN OBJET JAVASCRIPT
                return data.json();
            })
            .then(callbackJson)
    }

    // URL API AJAX
    var ajouterImage = function (objetJS)
    {
        // CA Y'EST J'AI UN OBJET JS AVEC TOUTES INFOS PLANQUEES DEDANS...
        // IL FAUT ALLER RECUPERER LES INFOS QUI NOUS INTERESSENT
        var tableauInfo = objetJS["hydra:member"];
        // objet.propriete OU objet["propriete"]
        // BOUCLE POUR PARCOURIR LES INFOS UNE PAR UNE
        for (var index = 0; index < tableauInfo.length; index++) {
            var infoCourante = tableauInfo[index];
            //onsole.log(infoCourante);
            var link = infoCourante.link;
            var thumbnail = infoCourante.thumbnail;
            var lowResolution = infoCourante.lowResolution;
            var standardResolution = infoCourante.standardResolution;
            if (link) {
                var baliseUl = document.querySelector("div.liste");
                // DOM Document Object Model
                // AJOUTER UNE BALISE li
                var codeHtmlLi = '<a href="' + link + '"><div class="listeInfo img-thumbnail" style="background-image:url(' + standardResolution + ');background-size:cover;background-position:center center";></div></a>';
                // AJOUTER NOTRE CODE POUR LA BALISE li DANS LA BALISE ul
                //baliseUl.innerHTML += codeHtmlLi;
                baliseUl.innerHTML += codeHtmlLi;
            }
            animWall();
        }

    }
    appelAjax(urlApiAjax, ajouterImage);

    // ANIMATIONS DES PHOTOS DU WALLOFPICTURE

    function animWall() {
        let bars = document.querySelectorAll('.listeInfo')
        const NUM_ELEMENTS = bars.length
        const BAR_ANIM_DURATION = 2.65

        bars.forEach((bar, index) => {


            // Set 'animation-duration'
            bar.style.animationDuration = `${BAR_ANIM_DURATION}s`

            // Calculate Staggered Delay
            let barDelay = index * (BAR_ANIM_DURATION / NUM_ELEMENTS) * 2

            // Set Staggered Delay
            bar.style.animationDelay = `${barDelay}s`

            bar.classList.add("animWall");
        })
    }






</script>
</html>
